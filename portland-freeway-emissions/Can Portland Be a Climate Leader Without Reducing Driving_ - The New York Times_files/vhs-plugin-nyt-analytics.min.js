(window.webpackJsonpVHS=window.webpackJsonpVHS||[]).push([[6],{366:function(e,t,i){"use strict";i.r(t);var a=i(2),s=i(57),r=i(109),o=i(4),n=i(3),l=i.n(n),d=i(111),u=i.n(d),h=i(17);const p=new o.a("vhs:util:session-storage");var v=class{constructor(e="nytvhs"){this.prefix=e}getItem(e){try{const t=sessionStorage.getItem(`${this.prefix}.${e}`);return JSON.parse(t)}catch(e){p.error(e)}return null}setItem(e,t){try{sessionStorage.setItem(`${this.prefix}.${e}`,JSON.stringify(t))}catch(e){p.error(e)}}removeItem(e){try{sessionStorage.removeItem(`${this.prefix}.${e}`)}catch(e){p.error(e)}}clear(){try{Object.keys(sessionStorage).filter(e=>0===e.indexOf(this.prefix)).forEach(e=>sessionStorage.removeItem(e))}catch(e){p.error(e)}}};const m=new o.a("vhs:plugin:nyt-tracking"),y=new v;class c{constructor(e,t){this.store=e,this.player=t,this.state={mediaSessionId:u()(),startTimestamp:Date.now(),readyTimestamp:null,timeToPlayStart:null,timeToPlayEnd:null,playerLoadTime:null,isFirstPlay:!0,wasLastMediaEnded:!1}}init(){this.subscribe()}subscribe(){this.store.whenever("player.media.id",()=>!0,(e,t)=>{void 0!==t&&(this.state.mediaSessionId=u()(),this.state.isFirstPlay=!1,this.state.wasLastMediaEnded=!1)}),this.store.whenever("player.shouldPlay",!0,()=>{this.state.timeToPlayStart=Date.now()}),this.store.whenever("player.isAdActive",!0,()=>{this.state.timeToPlayStart=null,this.state.timeToPlayEnd=null}),this.store.whenever("player.isAdActive",!1,()=>{this.state.timeToPlayStart=Date.now()}),this.store.whenever("player.isMediaPlaying",!0,()=>{this.store.getState().player.isAdActive||(this.state.timeToPlayEnd=Date.now())}),this.store.whenever("player",()=>!0,(e,t={})=>{e.media&&t.media&&e.media.id===t.media.id&&t.isMediaEnded&&e.isMediaPlaying&&(this.state.mediaSessionId=u()())});const e=this.store.whenever("player.isReady",!0,()=>{this.state.readyTimestamp=Date.now(),e()})}getDefaultBatch(){const e={ad_duration:this.getAdDuration(),ad_load_time:this.getAdLoadTime(),ad_id:this.getAdId(),ad_creative_id:this.getAdCreativeId(),ad_position:this.getAdPosition(),ad_enabled:this.getAdEnabled(),ad_type:this.getAdType(),captions_available:this.getCaptionsAvailable(),captions_enabled:this.getCaptionsEnabled(),transcript_available:this.getTranscriptAvailable(),client_id:this.getClientId(),delivery_method:this.getDeliveryMethod(),error_code:this.getErrorCode(),error_message:this.getErrorMessage(),is_inview:this.getIsInview(),level:this.getLevel(),mute_enabled:this.getMuteEnabled(),other_data:this.getOtherData(),play_id:this.getPlayId(),seek_time:this.getSeekTime(),time_of_event:Date.now(),viewing_mode:this.getViewingMode(),voiceover_running:this.getVoiceoverRunning()};return Object.keys(e).forEach(t=>{void 0===e[t]&&delete e[t]}),e}getCompleteBatch(){const e={...this.getDefaultBatch(),aspect_ratio:this.getAspectRatio(),autoplay:this.getAutoplay(),creation_type:this.getCreationType(),duration:this.getDuration(),headline:this.getHeadline(),media_id:this.getMediaId(),media_type:this.getMediaType(),play_intent:this.getPlayIntent(),player_load_time:this.getPlayerLoadTime(),player_time_to_download:this.getPlayerTimeToDownload(),player_loc:this.getPlayerLoc(),player_size:this.getPlayerSize(),player_time_to_play:this.getPlayerTimeToPlay(),primary_playlist_headline:this.getPrimaryPlaylistHeadline(),primary_playlist_id:this.getPrimaryPlaylistId(),section:this.getSection(),series:this.getSeries(),test_variant:this.getTestVariant(),type:this.getType(),uri:this.getUri(),vhs_version:this.getVhsVersion()};return Object.keys(e).forEach(t=>{void 0===e[t]&&delete e[t]}),e}getDuration(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.duration}getType(){try{const e=this.store.getState().player.options.mediaType===h.a.AUDIO,t=this.store.getState().player.media.is360,i=this.store.getState().player.media.playlist.isPaidPost,a=this.store.getState().player.isAdActive;return i&&c.type.PAID_POST||a&&c.type.AD||t&&c.type["360video"]||e&&c.type.AUDIO||c.type.VIDEO}catch(e){return}}getPlayerType(){const e=l.a.query('meta[name="PT"]'),t=l.a.query('meta[name="PST"]'),i=l.a.query('meta[name="slug"]'),a=(null==e?void 0:e.content)||"",s=(null==t?void 0:t.content)||"",r=(null==i?void 0:i.content)||"",o=a&&s?`${a.toLowerCase()}-${s.toLowerCase()}`:null;let n=null;return this.store.getState().player.options.type?n=this.store.getState().player.options.type:"multimedia-interactive"===o&&r?n=`${o}|${r}`:o?n=o:m.error("Player TYPE should be provided"),n}getAdDuration(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.adData)||void 0===i?void 0:i.duration}getCreationType(){var e,t,i;if("vanilla_js"===(null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.usage))return c.creationType.JS}getMediaId(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.id}getHeadline(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.headline}getPrimaryPlaylistId(){var e,t,i,a;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i||null===(a=i.playlist)||void 0===a?void 0:a.id}getPrimaryPlaylistHeadline(){var e,t,i,a;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i||null===(a=i.playlist)||void 0===a?void 0:a.headline}getDeliveryMethod(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.playbackType}getVhsVersion(){return"v3.52.1"}getPlayIntent(){var e,t,i;const a=null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.autoplay;return this.state.isFirstPlay?a?c.playIntent.AUTO:c.playIntent.USER:this.state.wasLastMediaEnded?a?c.playIntent.NEXT_AUTO:c.playIntent.NEXT_USER:c.playIntent.UNKNOW}getMediaType(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.mediaType}getAutoplay(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.autoplay}getPlayerLoadTime(){if(!this.state.readyTimestamp)return;return this.state.readyTimestamp-this.state.startTimestamp}getPlayerTimeToDownload(e=window.performance){if(this.state.playerLoadTime)return this.state.playerLoadTime;try{const t=e.getEntries().filter(e=>/(vhs\.js|vhs\.min\.js)/.test(e.name))[0];return this.state.playerLoadTime=t.duration,this.state.playerLoadTime}catch(e){return}}getPlayerSize(e=window.performance){if(this.state.playerSize)return this.state.playerSize;try{const t=e.getEntries().filter(e=>/(vhs\.js|vhs\.min\.js)/.test(e.name))[0];return this.state.playerSize=t.transferSize,this.state.playerSize}catch(e){return}}getMuteEnabled(){var e,t;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t?void 0:t.isMediaMuted}getCaptionsEnabled(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.plugins)||void 0===t||null===(i=t.captions)||void 0===i?void 0:i.areCaptionsEnabled}getClientId(){let e=y.getItem("clientId");return e||(e=u()(),y.setItem("clientId",e)),e}getCaptionsAvailable(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.plugins)||void 0===t||null===(i=t.captions)||void 0===i?void 0:i.areCaptionsAvailable}getPlayId(){return this.state.mediaSessionId}getUri(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.url}getErrorCode(){var e,t,i,a;return null===(e=this.player)||void 0===e||null===(t=e.playback)||void 0===t||null===(i=t.video)||void 0===i||null===(a=i.error)||void 0===a?void 0:a.code}getErrorMessage(){var e,t,i,a;return null===(e=this.player)||void 0===e||null===(t=e.playback)||void 0===t||null===(i=t.video)||void 0===i||null===(a=i.error)||void 0===a?void 0:a.message}getIsInview(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.plugins)||void 0===t||null===(i=t.viewportIntersectionObserver)||void 0===i?void 0:i.isInsideViewport}getPlayerTimeToPlay(){const e=this.state.timeToPlayEnd-this.state.timeToPlayStart;return isNaN(e)?void 0:e}getAspectRatio(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.ratio}getLevel(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.hlsLevel}getSeries(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.series}getSection(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.section}getTestVariant(){return 0}getPlayerLoc(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.type}getVoiceoverRunning(){}getViewingMode(){return"standard"}getOtherData(){}getAdLoadTime(){var e,t,i,a;const s=this.store.getState(),r=null==s||null===(e=s.player)||void 0===e||null===(t=e.adData)||void 0===t?void 0:t.loadStartTimestamp,o=(null==s||null===(i=s.player)||void 0===i||null===(a=i.adData)||void 0===a?void 0:a.loadEndTimestamp)-r;return isNaN(o)?void 0:o}getSeekTime(){var e,t;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t?void 0:t.seekTo}getAdId(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.adData)||void 0===i?void 0:i.id}getAdCreativeId(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.adData)||void 0===i?void 0:i.creativeId}getAdPosition(){var e,t,i;const a=null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.adData)||void 0===i?void 0:i.position;return 0===a?"preroll":-1===a?"postroll":a>0?"midroll":void 0}getAdEnabled(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.ads}getAdType(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.player)||void 0===t||null===(i=t.options)||void 0===i?void 0:i.ads}getTranscriptAvailable(){var e,t,i;return null===(e=this.store.getState())||void 0===e||null===(t=e.plugins)||void 0===t||null===(i=t.transcript)||void 0===i?void 0:i.isTranscriptAvailable}getCompleteEvent(){return this.getType()===c.type.AUDIO?"audio-complete":"video-complete"}getTrackingConfig(){let e;switch(this.getType()){case c.type.AD:e={...c.adConfig};break;case c.type.PAID_POST:e={...c.paidPostConfig};break;case c.type["360video"]:e={...c.video360Config};break;case c.type.AUDIO:e={...c.audioConfig};break;case c.type.VIDEO:default:e={...c.videoConfig}}return e}}c.creationType={JS:"js",HTML:"html"},c.type={VIDEO:"video",AD:"ad",PAID_POST:"paidPost","360video":"360video",AUDIO:"audio"},c.playIntent={USER:"user",AUTO:"auto",NEXT_USER:"next_user",NEXT_AUTO:"next_auto",UNKNOW:"unknow"},c.videoConfig={videoType:c.type.VIDEO,module:"video-player",mData:{}},c.video360Config={videoType:c.type["360video"],module:"video-player",mData:{}},c.adConfig={videoType:c.type.AD,module:"video-player",mData:{}},c.paidPostConfig={videoType:c.type.PAID_POST,module:"video-player",mData:{}},c.audioConfig={videoType:c.type.AUDIO,module:"audio-player",mData:{}};var g=c;const T=new o.a("vhs:plugin:nyt-analytics"),D=(...e)=>{Promise.resolve().then(()=>T.log(...e))},S=window.dataLayer||[];t.default=class{constructor(e,t){this.store=e,this.player=t,this.dimensions=new g(e,t),this.unsubscribes=[],this.firstPlay=!0,this.startUpTimeSent=!1,this.loadedTimestamp=null}init(){this.dimensions.init(),this.setOncePerMediaTrackers(),this.subscribe(),this.trackPlayerLoad(),this.trackMediaLoad(),this.trackInview(),this.trackPause(),this.trackResume(),this.trackSeek(),this.trackMediaComplete(),this.trackMute(),this.trackUnmute(),this.trackEnterFullscreen(),this.trackExitFullscreen(),this.trackAdPause(),this.trackAdResume(),this.trackAdStart(),this.trackAdSkip(),this.trackAdComplete(),this.trackPlayerError(),this.trackRebuffering(),this.trackMediaError(),this.trackEndSlateInview(),this.trackEndSlateLoaded(),this.trackCaptionOn(),this.trackCaptionOff(),this.trackTwitter(),this.trackEmbed(),this.trackFacebook()}subscribe(){this.store.whenever("player",()=>!0,(e,t)=>{e.media&&t.media&&e.media.id===t.media.id&&t.isMediaEnded&&e.isMediaPlaying&&this.resetOncePerMediaTrackers()}),this.store.whenever("player.isMediaLoaded",!0,()=>{this.resetOncePerMediaTrackers()})}setOncePerMediaTrackers(){this.unsubscribes.push(this.track25PercentConsumed()),this.unsubscribes.push(this.track50PercentConsumed()),this.unsubscribes.push(this.track75PercentConsumed()),this.unsubscribes.push(this.track90PercentConsumed()),this.unsubscribes.push(this.track3SecondsConsumed()),this.unsubscribes.push(this.track30SecondsConsumed()),this.unsubscribes.push(this.trackPlay())}resetOncePerMediaTrackers(){this.unsubscribes.forEach(e=>e()),this.unsubscribes=[],this.setOncePerMediaTrackers()}trackPlayerLoad(){const e="player-load",t=this.store.getState();if(this.loadedTimestamp=new Date,t.player.isElementReady)D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e);else{const t=this.store.whenever("player.isElementReady",!0,()=>{t(),D(e,{dimensions:this.dimensions.getDefaultBatch()})})}}trackMediaLoad(){this.store.whenever("player.isMediaLoaded",!0,()=>{D("media-load",{dimensions:this.dimensions.getCompleteBatch()}),this.pushToDataLayer("media-load")})}trackInview(){this.store.getState().plugins.viewportIntersectionObserver.isInsideViewport&&(D("inview",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("inview")),this.store.whenever("plugins.viewportIntersectionObserver.isInsideViewport",!0,()=>{D("inview",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("inview")})}trackTwitter(){const e="share-tools-twitter";this.store.whenever("plugins.shareTools.sharedTwitter",!0,()=>{D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e)})}trackFacebook(){const e="share-tools-facebook";this.store.whenever("plugins.shareTools.sharedFacebook",!0,()=>{D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e)})}trackEmbed(){const e="share-tools-embed";this.store.whenever("plugins.shareTools.sharedEmbed",!0,()=>{D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e)})}trackPlay(){const e=this.store.whenever("player.isMediaPlaying",!0,()=>{if(this.store.getState().player.isAdActive)return;const t=this.store.getState(),i=t.player.options.autoplay;let a=i?"auto-play-start":"user-play";t.player.options.loop?a=i?"auto-play-loop":"user-play-loop":this.firstPlay||(a=i?"auto-play-next":"user-play-next"),!this.startUpTimeSent&&"audio"!==this.dimensions.getType()&&this.firstPlay&&this.videoStartUpTime(new Date),this.firstPlay=!1,e(),D(a,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(a)});return e}async trackPause(){if(this.store.getState().player.isAdActive)return;this.store.whenever("player.isMediaPlaying",!1,()=>{this.store.getState().plugins.controls.isMouseDown||(D("pause",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("pause"))})}trackResume(){this.store.whenever("player.isMediaPlaying",!0,()=>{var e,t;const i=this.store.getState();i.player.isSeeking||(null==i||null===(e=i.player)||void 0===e||null===(t=e.media)||void 0===t?void 0:t.progress)>0&&(D("resume",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("resume"))})}trackSeek(){this.store.whenever("player.isSeeking",!0,()=>{D("seek",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("seek")})}trackMediaComplete(){this.store.whenever("player.isMediaEnded",!0,()=>{D("media-complete",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("media-complete")})}trackMute(){this.store.whenever("player.isMediaMuted",!0,()=>{D("muted",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("muted")})}trackUnmute(){this.store.whenever("player.isMediaMuted",!1,()=>{D("unmuted",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("unmuted")})}track25PercentConsumed(){const e="percent-25-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{const i=this.store.getState();i.player.media.progress/i.player.media.duration>=.25&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}track50PercentConsumed(){const e="percent-50-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{const i=this.store.getState();i.player.media.progress/i.player.media.duration>=.5&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}track75PercentConsumed(){const e="percent-75-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{const i=this.store.getState();i.player.media.progress/i.player.media.duration>=.75&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}track90PercentConsumed(){const e="percent-90-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{const i=this.store.getState();i.player.media.progress/i.player.media.duration>=.9&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}track3SecondsConsumed(){const e="3-seconds-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{this.store.getState().player.media.progress>3&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}track30SecondsConsumed(){const e="30-seconds-consumed",t=this.store.whenever("player.media.progress",e=>e>0,()=>{this.store.getState().player.media.progress>30&&(t(),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))});return t}trackEnterFullscreen(){const e="enter-fullscreen";this.store.whenever("plugins.fullscreen.isFullscreen",!0,()=>{D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e)})}trackExitFullscreen(){this.store.whenever("plugins.fullscreen.isFullscreen",!1,()=>{D("exit-fullscreen",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("exit-fullscreen")})}trackAdPause(){this.player.on(a.a.AD_PAUSED,()=>{D("ad-pause",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("ad-pause")})}trackAdResume(){this.player.on(a.a.AD_RESUMED,()=>{D("ad-resume",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("ad-resume")})}trackAdStart(){let e="ad-start";this.player.on(a.a.AD_STARTED,()=>{const t=this.store.getState().player.options.autoplay;e=t?"ad-auto-play-start":"ad-user-play-next",this.startUpTimeSen||this.videoStartUpTime(new Date),D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e)})}trackAdSkip(){this.player.on(a.a.AD_SKIPPED,()=>{D("ad-skip",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("ad-skip")})}trackAdComplete(){this.player.on(a.a.AD_COMPLETED,()=>{D("ad-complete",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("ad-complete")})}trackPlayerError(){const e="player-error";window.addEventListener("error",t=>{-1!==((null==t?void 0:t.filename)||"").indexOf("vhs")&&(D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))}),this.player.on(a.a.ERROR,t=>{t&&t.target||(D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))})}trackLevelChange(){this.player.on(a.a.LEVEL_TYPE_CHANGE,()=>{D("level-change",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("level-change")})}trackRebuffering(){this.store.whenever("player.isMediaBuffering",!0,()=>{D("rebuffering",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("rebuffering")})}trackMediaError(){this.player.on(a.a.ERROR,e=>{e&&e.target&&(D("media-error",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("media-error"))})}trackEndSlateInview(){const e="endslate-inview";function t(e){return e.plugins.viewportIntersectionObserver.isInsideViewport&&e.plugins.endSlate.isVisible}this.store.whenever("plugins.viewportIntersectionObserver.isInsideViewport",!0,()=>{t(this.store.getState())&&(D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))}),this.store.whenever("plugins.endSlate.isLoaded",!0,()=>{t(this.store.getState())&&(D(e,{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer(e))})}trackEndSlateLoaded(){this.store.whenever("plugins.endSlate.isLoaded",!0,()=>{D("endslate-load",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("endslate-load")})}trackCaptionOn(){this.store.whenever("plugins.captions.areCaptionsEnabled",!0,()=>{D("caption-on",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("caption-on")})}trackCaptionOff(){this.store.whenever("plugins.captions.areCaptionsEnabled",!1,()=>{this.store.getState().plugins.captions.areCaptionsAvailable&&(D("caption-off",{dimensions:this.dimensions.getDefaultBatch()}),this.pushToDataLayer("caption-off"))})}videoStartUpTime(e){const t="video-time-to-start",i=this.player?this.player.props.playerStartTimestamp:null;this.startUpTimeSent=!0,e&&this.loadedTimestamp&&i&&(D(t,{dimensions:{...this.dimensions.getDefaultBatch(),videoTimeToStartFromLoaded:e.getTime()-this.loadedTimestamp.getTime(),videoTimeToStartFromInit:e.getTime()-i.getTime()}}),this.pushToDataLayer(t,{videoTimeToStartFromLoaded:e.getTime()-this.loadedTimestamp.getTime(),videoTimeToStartFromInit:e.getTime()-i.getTime()}))}pushToDataLayer(e,t){const i=this.getTrackingData(e,this.dimensions.getTrackingConfig(),t);S.push({event:"mediaEvent",media:i})}getTrackingData(e,t,i){var a,s,o,n,l,d,u,h;const p=this.store.getState();let v={module:t.module||"video-player",version:this.dimensions.getPlayerType()||"unknown",contentCollection:null==p||null===(a=p.player)||void 0===a||null===(s=a.media)||void 0===s?void 0:s.section,region:t.region||"",action:t.action||"",contentId:(null==p||null===(o=p.player)||void 0===o||null===(n=o.options)||void 0===n?void 0:n.nytAnalyticsId)||(null==p||null===(l=p.player)||void 0===l||null===(d=l.media)||void 0===d?void 0:d.id),eventName:e,eventTimestamp:(new Date).getTime(),referrer:Object(r.a)()||"",mData:{videoName:null==p||null===(u=p.player)||void 0===u||null===(h=u.media)||void 0===h?void 0:h.headline,videoType:t.videoType||this.dimensions.getType(),...t.mData,...i}};return e===this.dimensions.getCompleteEvent()?v.state="completed":this.player.isPaused()?v.state="paused":v.state="playing","video-player"===v.module?v=this.addVideoData(v):"audio-player"===v.module&&(v.mData={...v.mData,...this.audioMData()}),v}addVideoData(e){var t,i,a,r,o,n,l,d,u,h,p,v,m,y,c,g,T,D,S,f,k,P,w,b,E,L,A,I,_,C,M;const O=this.store.getState();var B,U,V,R,N,x,F,j,$;(e.mData.device=Object(s.a)(),e.mData.playerType=this.dimensions.getPlayerType()||"",e.mData.playerUsage=O.player.options.usage||"",e.mData.playerVersion="v3.52.1",e.mData.tech="html5",e.mData.transcriptAvailable=null==O||null===(t=O.plugins)||void 0===t||null===(i=t.transcript)||void 0===i?void 0:i.isTranscriptAvailable,e.mData.hd_available=!!(null!=O&&null!==(a=O.player)&&void 0!==a&&null!==(r=a.media)&&void 0!==r&&r.hdSrc||null!=O&&null!==(o=O.player)&&void 0!==o&&null!==(n=o.media)&&void 0!==n&&n.hlsHdSrc),e.mData.videoDeliveryMethod=null!=O&&null!==(l=O.player)&&void 0!==l&&null!==(d=l.media)&&void 0!==d&&d.isLive?"live":"vod",e.mData.videoDuration=Math.round(null==O||null===(u=O.player)||void 0===u||null===(h=u.media)||void 0===h?void 0:h.duration),e.mData.videoFranchise=null==O||null===(p=O.player)||void 0===p||null===(v=p.media)||void 0===v?void 0:v.series,e.mData.videoPrimaryPlaylistId=null==O||null===(m=O.player)||void 0===m||null===(y=m.media)||void 0===y||null===(c=y.playlist)||void 0===c?void 0:c.id,e.mData.videoPrimaryPlaylistName=null==O||null===(g=O.player)||void 0===g||null===(T=g.media)||void 0===T||null===(D=T.playlist)||void 0===D?void 0:D.headline,e.mData.videoSection=null==O||null===(S=O.player)||void 0===S||null===(f=S.media)||void 0===f?void 0:f.section,e.mData.videoSubSection="",e.mData.videoTimeOfEvent=this.player.getCurrentTime(),e.mData.aspectRatio=null==O||null===(k=O.player)||void 0===k||null===(P=k.media)||void 0===P?void 0:P.ratio,O.plugins.captions&&(e.mData.captionsAvailable=O.plugins.captions.areCaptionsAvailable,e.mData.captionsEnabled=O.plugins.captions.areCaptionsEnabled),e.mData.muteEnabled=O.player.isMediaMuted,e.mData.adEnabled=null===(w=this.store.getState())||void 0===w||null===(b=w.player)||void 0===b||null===(E=b.media)||void 0===E?void 0:E.ads,"ad"===e.mData.videoType)&&(e.mData.adPosition="preroll",e.mData.adDuration=Math.round(O.player.adData.duration),e.mData.adType=null===(B=this.store.getState())||void 0===B||null===(U=B.player)||void 0===U||null===(V=U.options)||void 0===V?void 0:V.ads,e.mData.adId=null===(R=this.store.getState())||void 0===R||null===(N=R.player)||void 0===N||null===(x=N.adData)||void 0===x?void 0:x.id,e.mData.adDuration=null===(F=this.store.getState())||void 0===F||null===(j=F.player)||void 0===j||null===($=j.adData)||void 0===$?void 0:$.duration);return"video"!==e.mData.videoType||null==O||null===(L=O.player)||void 0===L||null===(A=L.media)||void 0===A||null===(I=A.playlist)||void 0===I||!I.isSponsored||null!=O&&null!==(_=O.player)&&void 0!==_&&null!==(C=_.media)&&void 0!==C&&null!==(M=C.playlist)&&void 0!==M&&M.isPaidPost||(e.mData.adPosition="flexframe"),e}audioMData(){var e,t,i,a,r,o,n,l;const d=this.store.getState();return{device:Object(s.a)(),playerType:this.dimensions.getPlayerType()||"",playerUsage:d.player.options.usage||"",playerVersion:"v3.52.1",tech:"html5",deliveryMethod:null!=d&&null!==(e=d.player)&&void 0!==e&&null!==(t=e.media)&&void 0!==t&&t.isLive?"live":"aod",duration:Math.round(null==d||null===(i=d.player)||void 0===i||null===(a=i.media)||void 0===a?void 0:a.duration),series:null==d||null===(r=d.player)||void 0===r||null===(o=r.media)||void 0===o?void 0:o.series,section:null==d||null===(n=d.player)||void 0===n||null===(l=n.media)||void 0===l?void 0:l.section,subSection:"",timeOfEvent:this.player.getCurrentTime()}}}}}]);
//# sourceMappingURL=vhs-plugin-nyt-analytics.min.js.map